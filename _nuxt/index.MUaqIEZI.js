import{_ as G}from"./Header.7VXvSm76.js";import{_ as K}from"./client-only.XfvCy8nb.js";import{H as Q,o as R,c as S,a as o,I as W,r as k,f as N,s as V,g as X,J as Z,i as x,k as ee,m as d,b as s,t as b,w as n,as as p,a7 as se,$ as M,_ as oe,d as _,p as te,e as ne,at as le,au as ae}from"./entry.kq51Fg3O.js";import{$ as B}from"./func.-JA0-Hy7.js";import{h as re}from"./moment.WSJ9un1t.js";import{m as H}from"./md5.V_qtkgdV.js";import{_ as ie}from"./_plugin-vue_export-helper.x3n3nnut.js";import{N as de}from"./Icon.zMbbtivR.js";import{_ as ue}from"./Input.CTz0GiOB.js";import{a as ce,_ as pe}from"./FormItem.faDxoqNm.js";import"./use-compitable.Iu7xpuxN.js";import"./use-merged-state.lIriCt8y.js";import"./format-length.4l65r8M5.js";const _e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},fe=o("path",{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 0 0 0-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 0 0 9.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3l-362.7 362.6l-88.9 15.7l15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z",fill:"currentColor"},null,-1),me=[fe],we=Q({name:"EditOutlined",render:function(y,C){return R(),S("svg",_e,me)}}),f=m=>(te("data-v-0f0f6512"),m=m(),ne(),m),ge={class:"container-full flex-col align-items-center header-mt-def"},he={key:0,class:"container border-box flex-col px-10 pb-10"},ve={class:"tb-filed mt-10"},ke=f(()=>o("th",null,"邮箱：",-1)),xe=f(()=>o("th",null,"昵称：",-1)),be={class:"flex-row align-items-center pointer"},ye=f(()=>o("th",null,"VIP到期：",-1)),Ce={colspan:"3"},Ie=f(()=>o("th",null,"最近登录：",-1)),$e={colspan:"3"},Me={class:"mt-10"},Re={class:"pw-form"},Se=f(()=>o("div",{class:"fs-16 fw-600 pb-10"},"修改密码",-1)),Ue={class:"flex-row justify-content-end"},qe={class:"pw-form"},Le=f(()=>o("div",{class:"fs-16 fw-600 pb-10"},"修改资料",-1)),Ne={class:"flex-row justify-content-end"},Ve=Object.assign({name:"userIndex"},{__name:"index",setup(m){const y=W(),C=k(null),U=k(null),P=N.glob();V(P);const g=X(),z=Z(),I=N.user();let a=k(!1),r=k(!1);const i=x({old_password:"",password:"",re_password:""}),u=x({nickname:""}),{info:w,isLogin:O}=V(I);u.nickname=w.value.nickname;const Y=x({old_password:{required:!0,trigger:["blur","input"],message:"请输入旧密码"},password:{required:!0,trigger:["blur","input"],message:"请输入密码，最少8位",validator:(l,e)=>e.length>=8},re_password:{required:!0,trigger:["blur","input"],message:"确认密码错误",validator:(l,e)=>e===i.password}}),j=x({nickname:{required:!0,trigger:["blur","input"],message:"请输入昵称，2到16位",validator:(l,e)=>e.length>=2&&e.length<=16}}),D=async()=>{await M.get("user/logout",null,{server:!1})&&(I.logout(),z.push({path:"/"}))},E=ee(()=>l=>l<re().unix()?"已到期":B.timeFmt(l,"YYYY-MM-DD")),T=()=>{var l;(l=C.value)==null||l.validate(async e=>{e||(g.start(),await M.post("user/password",le({},i,{password:H(i.password),old_password:H(i.old_password)}),{server:!1})&&(y.success("密码修改成功"),a.value=!1),g.finish())}).catch(()=>!1)},F=()=>{var l;(l=U.value)==null||l.validate(async e=>{e||(g.start(),await M.post("user/profile",u,{server:!1})&&(y.success("资料修改成功"),r.value=!1,I.setInfo("nickname",u.nickname)),g.finish())}).catch(()=>!1)};return(l,e)=>{const $=G,J=de,c=oe,h=ue,v=ce,q=pe,L=ae,A=K;return R(),S("div",ge,[d(O)?(R(),S("div",he,[s($,{act:"info"}),o("table",ve,[o("tbody",null,[o("tr",null,[ke,o("td",null,b(d(w).email),1),xe,o("td",be,[o("span",null,b(d(w).nickname),1),s(J,{size:"24px",onClick:e[0]||(e[0]=t=>p(r)?r.value=!0:r=!0)},{default:n(()=>[s(d(we))]),_:1})])]),o("tr",null,[ye,o("td",Ce,b(E.value(d(w).vip_at)),1)]),o("tr",null,[Ie,o("td",$e,b(("$func"in l?l.$func:d(B)).timeFmt(d(w).login_at)),1)])])]),o("div",Me,[s(c,{class:"mr-10",round:"",onClick:e[1]||(e[1]=t=>p(a)?a.value=!0:a=!0)},{default:n(()=>[_("修改密码")]),_:1}),s(c,{round:"",onClick:D},{default:n(()=>[_("退出登录")]),_:1})])])):se("",!0),s(A,null,{default:n(()=>[s(L,{show:d(a),"onUpdate:show":e[6]||(e[6]=t=>p(a)?a.value=t:a=t)},{default:n(()=>[o("div",Re,[Se,s(q,{ref_key:"formRef",ref:C,model:i,rules:Y,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:n(()=>[s(v,{label:"旧密码",path:"old_password"},{default:n(()=>[s(h,{type:"password","show-password-on":"click",maxlength:32,value:i.old_password,"onUpdate:value":e[2]||(e[2]=t=>i.old_password=t),placeholder:"请输入旧密码"},null,8,["value"])]),_:1}),s(v,{label:"新密码",path:"password"},{default:n(()=>[s(h,{type:"password","show-password-on":"click",maxlength:32,value:i.password,"onUpdate:value":e[3]||(e[3]=t=>i.password=t),placeholder:"请输入新密码"},null,8,["value"])]),_:1}),s(v,{label:"确认密码",path:"re_password"},{default:n(()=>[s(h,{type:"password","show-password-on":"click",maxlength:32,value:i.re_password,"onUpdate:value":e[4]||(e[4]=t=>i.re_password=t),placeholder:"请输入确认密码"},null,8,["value"])]),_:1}),o("div",Ue,[s(c,{round:"",onClick:e[5]||(e[5]=t=>p(a)?a.value=!1:a=!1)},{default:n(()=>[_(" 取消 ")]),_:1}),s(c,{class:"ml-10",round:"",color:"#ffd100","text-color":"#000",onClick:T},{default:n(()=>[_(" 确认修改 ")]),_:1})])]),_:1},8,["model","rules"])])]),_:1},8,["show"]),s(L,{show:d(r),"onUpdate:show":e[9]||(e[9]=t=>p(r)?r.value=t:r=t)},{default:n(()=>[o("div",qe,[Le,s(q,{ref_key:"formProfileRef",ref:U,model:u,rules:j,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:n(()=>[s(v,{label:"昵称",path:"nickname"},{default:n(()=>[s(h,{value:u.nickname,"onUpdate:value":e[7]||(e[7]=t=>u.nickname=t),placeholder:"请输入昵称"},null,8,["value"])]),_:1}),o("div",Ne,[s(c,{round:"",onClick:e[8]||(e[8]=t=>p(r)?r.value=!1:r=!1)},{default:n(()=>[_(" 取消 ")]),_:1}),s(c,{class:"ml-10",round:"",color:"#ffd100","text-color":"#000",onClick:F},{default:n(()=>[_(" 确认修改 ")]),_:1})])]),_:1},8,["model","rules"])])]),_:1},8,["show"])]),_:1})])}}}),Ge=ie(Ve,[["__scopeId","data-v-0f0f6512"]]);export{Ge as default};
